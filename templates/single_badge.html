{% extends 'user_base.html' %}

{% block body %}

<div class="container hidden-sm">
  <div class="row">
    <div class="col-8">
      <div class="page-header">
        <h1>
          {{badge.name}} 
          {% if not (teacher_view_student_badge or student_badge) %}
          {% endif %}

        </h1>
        {% set badge_checkpoints = get_checkpoints_for_badge(badge=badge, user=teacher) %}
        {% if badge_checkpoints and (teacher_view_student_badge or not student_badge) %}
          <p><span class="text-muted">Associated with the following checkpoints: </span></p>
          {% for checkpoint in badge_checkpoints %}
            <p><a href="/course/{{checkpoint.key.parent().get().key.id()}}/checkpoint/{{checkpoint.key.id()}}">{{checkpoint.key.parent().get().course_name}}, {{checkpoint.name}} </a></p>
          {% endfor %}
          
        {% else %}
        {% endif %}
      </div>
      <p class="lead">{{badge.requirement}}</p>
      {% if teacher_view_student_badge or student_badge %}
        <hr>
        <h4>Comment History</h4>
        {% if evidence %}
          {% for item in evidence %}
            <blockquote>
              <p>{{item.content}}</p>
              <small>Someone famous in <cite title="Source Title">Source Title</cite></small>
            </blockquote>
          {% endfor %}

        {% endif %}
      {% endif %}

      
    </div>
    <div class="col-4">
      <div class="badge-page-badge">
        <div class="badge-div">
          <div class="badge-new" style="background: {{badge.background}}; color: {{badge.icon_color}}">
            <div class="badge-icon-container"><i class="icon-{{badge.icon}}"></i></div>
          </div>
        </div>
      </div>
        {% if not student_badge %}
          <a class="btn btn-info btn-block" href="/badge_creator/{{badge.key.id()}}">Edit Badge</a>
        {% endif %}
        {% if teacher_view_student_badge %}
          <a class="btn btn-info btn-block" href="/badge/{{badge.key.id()}}">Progress of all Students</a>
          <div class="callout callout-info">
            <h4>{{student.formalName}}</h4>
              {% if achievement_status =='requested' %}
                <p>Student has requested this badge</p>
              {% elif achievement_status =='denied' %}
                <p>You denied student's badge request</p>
              {% elif achievement_status =='revoked' %}
                <p>You revoked student's badge award</p>
              {% elif achievement_status =='awarded' %}
                <p>You awarded student this badge</p>
              {% else %}
                <p>Student has not yet recieved this badge</p>
              {% endif %}
              {% if achievement_status != 'awarded' %}
                <a class="btn btn-success btn-loading btn-block" href="/student_badge/{{student.key.id()}}/{{course.key.id()}}/{{badge.key.id()}}/teacher_view/award/awarded">Award Badge</a>
              {% else %}
                <a class="btn btn-danger btn-loading btn-block" href="/student_badge/{{student.key.id()}}/{{course.key.id()}}/{{badge.key.id()}}/teacher_view/award/revoked">Revoke Badge</a>
              {% endif %}
              {% if achievement_status == 'requests' %}
                <a class="btn btn-danger btn-loading btn-block" href="/student_badge/{{student.key.id()}}/{{course.key.id()}}/{{badge.key.id()}}/teacher_view/award/denied">Deny Request</a>
              {% endif %}
          </div>
          {% elif student_badge %}
            <h4>Your Progress</h4>
            {% if achievement_status == 'awarded' %}
              <p>Awesome! Your teacher has awarded you this badge</p>
            {% elif achievement_status =='requested' %}
              <p>You have requested this badge</p>
            {% elif achievement_status =='denied' %}
              <p>Your request has been denied</p>
              <a href="/request_badge/{{teacherID}}/{{courseID}}/{{badge.key.id()}}" class="btn-loading btn btn-primary btn-block">Request This Badge</a>
            {% elif achievement_status =='revoked' %}
              <p>Your badge has been revoked</p>
              <a href="/request_badge/{{teacherID}}/{{courseID}}/{{badge.key.id()}}" class="btn-loading btn btn-primary btn-block">Request This Badge</a>
            {% else %}
              <p>You have not yet been awarded this badge</p>
              <a href="/request_badge/{{teacherID}}/{{courseID}}/{{badge.key.id()}}" class="btn-loading btn btn-primary btn-block">Request This Badge</a>
            {% endif %}

        {% endif %}
        
        {% if teacher_view_student_badge or student_badge %}
        <h4>Add Comment</h4>
          {% if teacher_view_student_badge %}
          <p class="text-muted">As the teacher, you may wish to describe why you awarded, denied, revoked, this badge. Your student will also be able to add comments if they wish to describe why the think they deserve this badge</p>
          {% endif %}
          <form method="post">
            <textarea class="form-control" rows="10" name="content"></textarea>
            <br>
            <button class="submit btn btn-primary btn-block">Submit Comment</button>
          </form>
        {% endif %}
      </div>
  </div>
  {% if not (student_badge or teacher_view_student_badge) %}
    <div class="hidden-sm row">
      {% include 'badge_course_list.html' %}
    </div>
  {% endif %}
    
  
</div>

<div class="mobile-page visible-sm">
  <div class="row mobile-row mobile-header">
    <h1>{{badge.name}}</h1>
    <h3>
      <div class="mobile-page-badge">
        <div class="badge-div">
          <div class="badge-new" style="background: {{badge.background}}; color: {{badge.icon_color}}">
            <div class="badge-icon-container"><i class="icon-{{badge.icon}}"></i></div>
          </div>
        </div>
      </div>
    </h3>
    <div class="col-12">
      <p class="lead"><strong>Requirements:</strong> {{badge.requirement}}</p>
    </div>
    {% if not (student_badge or teacher_view_student_badge) %}
      <div class="col-12">
        <a class="btn btn-default btn-block" href="/badge_creator/{{badge.key.id()}}">Edit Badge</a>
        {% for course in courses %}
          <a class="btn btn-default btn-block" data-toggle="tab" href="#mobile_badge_course_{{course.course.key.id()}}">Students in {{course.name}}</a>
        {% endfor %}
      </div>
    {% endif %}
    {% if teacher_view_student_badge %}
      <div class="col-12">
        <a class="btn btn-default btn-block" href="/badge_creator/{{badge.key.id()}}">Edit Badge</a>
        <a class="btn btn-default btn-block" href="/course/{{course.key.id()}}">Return to {{course.course_name}}</a>
        <a class="btn btn-default btn-block" href="/badge/{{badge.key.id()}}?active_course={{course.key.id()}}">See progress of all students</a>
      </div>

      <div class="col-12">
        <h3>{{student.formalName}}</h3>
        {% if achievement_status =='requested' %}
          <p class="lead">Student has requested this badge</p>
        {% elif achievement_status =='denied' %}
          <p class="lead">You denied student's badge request</p>
        {% elif achievement_status =='revoked' %}
          <p class="lead">You revoked student's badge award</p>
        {% elif achievement_status =='awarded' %}
          <p class="lead">You awarded student this badge</p>
        {% else %}
          <p class="lead">Student has not yet recieved this badge</p>
        {% endif %}
        {% if achievement_status != 'awarded' %}
          <a class="btn btn-success btn-loading btn-block" href="/student_badge/{{student.key.id()}}/{{course.key.id()}}/{{badge.key.id()}}/teacher_view/award/awarded">Award Badge</a>
        {% else %}
          <a class="btn btn-danger btn-loading btn-block" href="/student_badge/{{student.key.id()}}/{{course.key.id()}}/{{badge.key.id()}}/teacher_view/award/revoked">Revoke Badge</a>
        {% endif %}
        {% if achievement_status == 'requests' %}
          <a class="btn btn-danger btn-loading btn-block" href="/student_badge/{{student.key.id()}}/{{course.key.id()}}/{{badge.key.id()}}/teacher_view/award/denied">Deny Request</a>
        {% endif %}
      </div>
    {% endif %}
    {% if student_badge %}
      <div class="col-12">
        <a class="btn btn-default btn-block" href="/student_profile/{{teacher.key.id()}}/{{course.key.id()}}">Return to {{course.course_name}}</a>
        <h4>Your Progress</h4>
        {% if achievement_status == 'awarded' %}
          <p>Awesome! Your teacher has awarded you this badge</p>
        {% elif achievement_status =='requested' %}
          <p>You have requested this badge</p>
        {% elif achievement_status =='denied' %}
          <p>Your request has been denied</p>
          <a href="/request_badge/{{teacherID}}/{{courseID}}/{{badge.key.id()}}" class="btn-loading btn btn-primary btn-block">Request This Badge</a>
        {% elif achievement_status =='revoked' %}
          <p>Your badge has been revoked</p>
          <a href="/request_badge/{{teacherID}}/{{courseID}}/{{badge.key.id()}}" class="btn-loading btn btn-primary btn-block">Request This Badge</a>
        {% else %}
          <p>You have not yet been awarded this badge</p>
          <a href="/request_badge/{{teacherID}}/{{courseID}}/{{badge.key.id()}}" class="btn-loading btn btn-primary btn-block">Request This Badge</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  {% if not (student_badge or teacher_view_student_badge) %}
  <div class="tab-content">
    {% for course in courses %}
    <div class="tab-pane fade 
        {% if active_course == '' ~ course.course.key.id() %}in active 
        {% elif not active_course and loop.first %}in active
        {% endif %}" id="mobile_badge_course_{{course.course.key.id()}}">

        {% set registrations = course.registrations %}
        <table class="table mobile-table">
          <tr>
            <td class="mobile-table-right mobile-break-row" colspan="2">
              <h4>{{course.name}}</h4>
              <p>Badge status for each student enrolled in this course</p>
              <a class="btn btn-info btn-block" href="/course/{{course.course.key.id()}}">Course Home</a>
            </td>
          </tr>
        {% if course.enrolled_students %}
          {% for registration in registrations %}
            {% if registration.status == 'approved' %}
            {% set student = registration.student %}
            {% set current_achievement_status = achievement_status(student, badge, teacher, course.course) %}
            <tr>
              <td class="col-8 mobile-table-left">
                <h4>{{student.formalName}}</h4>
                <p class="text-muted">Badge Status: {{current_achievement_status }} </p>
              </td>
              <td class="col-4 mobile-table-right">
                {% if current_achievement_status != 'awarded' %}
                  <a class="btn-loading btn btn-success btn-block" href="/student_badge/{{student.key.id()}}/{{course.course.key.id()}}/{{badge.key.id()}}/teacher_view/award/awarded?single_badge=true">award</a>
                  {% if current_achievement_status == 'requested' %}
                    <a class="btn-loading btn btn-danger btn-block" href="/student_badge/{{student.key.id()}}/{{course.course.key.id()}}/{{badge.key.id()}}/teacher_view/award/denied?single_badge=true">deny</a>
                  {% endif %}
                {% else %}
                  <a class="btn-loading btn btn-warning btn-block" href="/student_badge/{{student.key.id()}}/{{course.course.key.id()}}/{{badge.key.id()}}/teacher_view/award/revoked?single_badge=true">revoke</a>
                {% endif %}
                <a class="btn btn-info btn-block" href="/student_badge/{{student.key.id()}}/{{course.course.key.id()}}/{{badge.key.id()}}/teacher_view">
                  view
                </a>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
        {% endif %}
        </table>  
    </div>
  {% endfor %}
  </div>
  {% endif %}

</div>




{% endblock %}