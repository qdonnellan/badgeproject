{% extends 'user_base.html' %}

{% block body %}

<div class="hidden-sm container">
  <div class="row">
    <div class="page-header">
    {% if not (student_profile or tracher_view_student_profile) %}
        <a class="btn btn-success pull-right hidden-sm" href="/course/{{courseID}}/new_checkpoint"><i class="icon-plus-sign-alt icon-large"></i> New Checkpoint</a>
        {% endif %}
      <h1>{{course.course.course_name}}</h1>
    </div>
    
    {% if teacher_view_student_profile %}
      <div class="callout callout-danger">
        <a href="/course/{{courseID}}" class="btn btn-default pull-right btn-small">Back to Teacher View</a>
        <h4><span class="text-muted">Student:</span> {{course.student.formalName}}</h4>
        <p>You are currently viewing this student's course profile. This page will appear to you as it does to the student. Clicking on badges will take you to the student's view of those badges. If you would like to go back to the teacher view of this page, just click <a href="/course/{{courseID}}">back to teacher view</a></p>
      </div>
    {% endif %}
    {% if student_profile %}
      <p class="text-muted">Instructor: {{course.teacher.formalName}}</p>
    {% endif %}
    
  </div>

  <div class="row">
    <ul class="nav nav-tabs hidden-sm">
      <li {% if active_tab == 'checkpoints' or not active_tab%}class="active"{% endif %}><a href="#checkpoints" data-toggle="tab">Checkpoints</a></li>
      {% if student_profile or teacher_view_student_profile %}
        <li {% if active_tab == 'requests' %}class="active"{% endif %}><a href="#requests" data-toggle="tab">Pending Requests</a></li>
      {% else %}
        <li {% if active_tab == 'requests' %}class="active"{% endif %}>
          <a href="#requests" data-toggle="tab">
            {% set requests = course.number_of_badge_requests %}
            {% if requests > 0 %}
              <span class="badge badge-notification">{{requests}} </span>
            {% endif %}
            Badge Requests
          </a>
        </li>
      {% endif %}
      {% if not (student_profile or teacher_view_student_profile)%}
        <li {% if active_tab == 'students' %}class = "active"{% endif %}>
          <a href="#students" data-toggle="tab">
            {% set pending_regs = course.number_of_pending_registrations %}
            {% if pending_regs > 0 %}
              <span class="badge badge-notification">{{pending_regs}} </span>
            {% endif %}
            Enrolled Students
          </a>
        </li>
        <li {% if active_tab == 'settings' %}class = "active"{% endif %}><a href="#settings" data-toggle="tab">Settings</a></li>
      {% endif %}       
    </ul>

    <div class="tab-content">
      {% if not (student_profile or teacher_view_student_profile) %}
      <div class="tab-pane fade {% if active_tab == 'students' %}in active{% endif %}" id="students">
        {% if course.registrations %}
          <div>
            <h3>Students Enrolled in Course</h3>
            <p class='text-muted'>Click on a student's name to view that student's progress in this course</p>
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Student Name</th>
                  <th class="hidden-sm">Registration Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for registration in course.registrations %}
                <tr>
                  <td>
                    <a href="/student_profile/{{registration.student_id}}/{{courseID}}/teacher_view">
                       {{get_student(registration.student_id).formalName}}
                    </a>
                  </td>
                  <td class="hidden-sm">
                    {% set reg_status = registration.status %}
                    {% if reg_status == 'approved' %}
                      <span class="text-success">enrolled</span>
                    {% elif reg_status == 'revoked' %}
                      <span class="text-danger">enrollment revoked</span>
                    {% elif reg_status == 'denied' %}
                      <span class="text-danger">request denied</span>
                    {% else %}
                      <span class="text-muted">not enrolled</span>
                    {% endif %}
                    
                  </td>
                  <td>
                  {% if registration.status == "pending"%}
                    <a class="btn-loading btn btn-small btn-success" href="/complete_registration/{{courseID}}/{{registration.student_id}}/approved">approve</a> 
                    <a class="btn btn-loading btn-small btn-danger" href="/complete_registration/{{courseID}}/{{registration.student_id}}/denied">deny</a>
                  {% elif registration.status == "approved" %}
                    <a class="btn-loading btn btn-small btn-warning" href="/complete_registration/{{courseID}}/{{registration.student_id}}/revoked">un-enroll</a>
                  {% elif registration.status == "denied" %}
                    <a class="btn-loading btn btn-small btn-success" href="/complete_registration/{{courseID}}/{{registration.student_id}}/approved">approve</a> 
                  {% elif registration.status == "revoked" %}
                    <a class="btn-loading btn btn-small btn-info" href="/complete_registration/{{courseID}}/{{registration.student_id}}/approved">re-admit</a>

                  {% endif %}  
                  </td>         

                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
        <div class="marketing-div">
          <br><br><br>
          <h2 class="text-muted">No students registered</h2>
        </div>
        {% endif %}

      </div>
      {% endif %}

      <div class="tab-pane fade {% if active_tab == 'checkpoints' or not active_tab %}in active{% endif %}" id="checkpoints">
        <br>
        
          {% for checkpoint in course.checkpoints %}
            {% if checkpoint.featured %}
              <div class="col-12 hidden-sm callout-checkpoint checkpoint-featured callout">
                {% include 'checkpoint_panel.html' %}
              </div>
            {% endif %}
          {% endfor %}
          {% for checkpoint in course.checkpoints %}
            {% if not checkpoint.featured %}
              <div class="col-12 hidden-sm callout-checkpoint callout">
                {% include 'checkpoint_panel.html' %}
              </div>
            {% endif %}
          {% endfor %}
      </div>
      {% if student_profile or teacher_view_student_profile %}
      <div class="tab-pane fade {% if active_tab == 'requests' %}in active{% endif %}" id="requests">
        
        {% set requests = course.requests %}
        {% if requests %}
          <table class="table">
            <thead>
              <tr>
                <th>Badge</th>
                <th>Request Status</th>
                <th>Last Update</th>
              </tr>
            </thead>
            <tbody>
              {% for request in requests %}
                {% if request.status in ['revoked', 'denied', 'requested'] %}
                  <tr>
                    <td>
                      {% if teacher_view_student_profile %}
                      <a href="/student_badge/{{course.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view">
                      {% else %}
                      <a href="/student_badge/{{teacherID}}/{{courseID}}/{{request.badge_id}}">
                      {% endif %}
                        {% set badge = request.badge %}
                        <div class="tiny-badge pull-left">
                          <div  class="badge-new" style="background: {{badge.background}}; color: {{badge.icon_color}}">
                            <div class="badge-icon-container"><i class="icon-{{badge.icon}}"></i></div>
                          </div>
                        </div> {{badge.name}}
                      </a>  
                    </td>
                    <td>{{request.status}}</td>
                    <td>{{request.last_modified}}</td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <h3 class='text-muted'>No active badge requests</h3>
        {% endif %}
      </div>
      {% else %}
      <div class="tab-pane fade {% if active_tab == 'requests' %}in active{% endif %}" id="requests">
        
        {% set requests = course.requests %}
        {% if course.number_of_badge_requests > 0 %}
          <div class="hidden-sm">
            <table class="table">
              <thead>
                <tr>
                  <th>Student Name</th>
                  <th>Badge</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for request in requests %}
                {% if request.status == 'requested' %}
                  <tr>
                    <td>{{request.student.formalName}}</td>
                    <td>
                      <a href="/student_badge/{{request.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view">
                        {% set badge = request.badge %}
                        <div class="tiny-badge pull-left">
                          <div  class="badge-new" style="background: {{badge.background}}; color: {{badge.icon_color}}">
                            <div class="badge-icon-container"><i class="icon-{{badge.icon}}"></i></div>
                          </div>
                        </div> {{badge.name}}
                      </a>
                    </td>
                    <td>
                        <a class="btn btn-info btn-small" href="/student_badge/{{request.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view">Evidence</a> 
                        <a class="btn btn-danger btn-small btn-loading" href="/student_badge/{{request.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view/award/denied?back_to_course=true">Deny Request</a> 
                        <a class="btn btn-success btn-small btn-loading" href="/student_badge/{{request.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view/award/awarded?back_to_course=true">Award Badge</a>

                    </td>
                    
                  </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
            </table>
          </div>
          
        {% else %}
          <div class="marketing-div">
            <br><br><br>
            <h2 class="text-muted">No active badge requests</h2>
        </div>
        {% endif %}
      </div>
      {% endif %}
      <div class="tab-pane fade {% if active_tab == 'settings' %}in active{% endif %}" id="settings">
        {% if error %}
          <br>
          <div class="alert alert-danger">
            <strong>Woops!</strong> {{error}}
          </div>
        {% endif %}
        <div class="row">
          <div class="col-12">
            <form method="post">   
              <div class="row">
                <div class="col-lg-6">
                <h3>Course Name</h3>
                  <p class="text-muted">Change your course name</p>
                  <input type="text" id="course_name" class="form-control" name="course_name" value="{{course.name}}"/>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-6">
                <h3>Course Code</h3>
                <p class="text-muted">Your students will need your google email address and this code to register for your course</p>
                  <input type="text" id="course_code" class = "form-control" name="course_code" value="{{course.code}}"/>
                </div>
                <div class="col-lg-6">
                  <div class="callout callout-warning">
                  <p><strong>The course code</strong> is what you will give to your students before they register for your course. They will be prompted to type your email address and this course code before their registration requests shows up in your profile. </p>
                  </div>
                </div>
              </div>
              <button class="btn btn-primary" type="submit">Save Course</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  
</div>  

<div class="mobile-page visible-sm">
  <div class="row mobile-row mobile-header">
    <h1>{{course.name}}</h1>
    <div class="col-12">
      <a href="/profile" class="btn btn-default btn-block">Back to Profile</a>
      <a href="#checkpoints-mobile" class="btn btn-default btn-block" data-toggle="tab">Checkpoints</a>
      {% if student_profile or teacher_view_student_profile %}
        <a href="#requests-mobile" class="btn btn-default btn-block" data-toggle="tab">Pending Requests</a>
      {% else %}
        <a href="#requests-mobile" class="btn btn-default btn-block" data-toggle="tab">
          {% set requests = course.number_of_badge_requests %}
          {% if requests > 0 %}
            <span class="badge badge-notification">{{requests}} </span>
          {% endif %}
          Badge Requests
        </a>
      {% endif %}
      {% if not (student_profile or teacher_view_student_profile)%}
        <a href="#students-mobile" class="btn btn-default btn-block" data-toggle="tab">
          {% set pending_regs = course.number_of_pending_registrations %}
          {% if pending_regs > 0 %}
            <span class="badge badge-notification">{{pending_regs}} </span>
          {% endif %}
          Enrolled Students
        </a>
        <a href="#settings-mobile" class="btn btn-default btn-block" data-toggle="tab">Settings</a>
      {% endif %}  
    </div>
  </div>
  <div class="tab-content">
    <div class="tab-pane fade {% if active_tab == 'checkpoints' or not active_tab %}in active{% endif %}" id="checkpoints-mobile">
      <table class="table mobile-table">
        {% if teacher_view_student_profile %}
        <tr>
          <td class="mobile-student-row " colspan="2">
            <h4><span class="text-warning">Viewing:</span> {{course.student.formalName}}</h4>
            <a class="btn btn-warning btn-block" href="/course/{{courseID}}">Return to Teacher view</a>
          </td>
        </tr>
        {% else %}
        <tr >
          <td class="mobile-break-row " colspan="2"><h5>Checkpoints for this course</h5></td>
        </tr>
        {% endif %}
      {% for checkpoint in course.checkpoints %}
        {% if checkpoint.featured %}
          <tr class="mobile-checkpoint-featured">
            <td class="col-9 mobile-table-left">
              <h4>{{checkpoint.name}}</h4>
              <p>{{checkpoint.description}}</p>
              {% for badge in checkpoint.badges %}
                {% include 'small_badge_mobile.html' %}
              {% endfor %}
            </td>
            <td class="col-3 mobile-table-info mobile-table-right">
              {% if teacher_view_student_profile or student_profile %}
                <h4>{{checkpoint.percent_complete}}%</h4>
                <p class="text-muted">complete</p>
              {% else %}
                <a href="/course/{{course.course.key.id()}}/checkpoint/{{checkpoint.checkpoint.key.id()}}" class="btn btn-info">view</a>
              {% endif %}
            </td>
          </tr>
        {% endif %}
        {% endfor %}
        {% for checkpoint in course.checkpoints %}
          {% if not checkpoint.featured %}
            <tr class="mobile-checkpoint">
              <td class="col-9 mobile-table-left">
                <h4>{{checkpoint.name}}</h4>
                <p>{{checkpoint.description}}</p>
                {% for badge in checkpoint.badges %}
                  {% include 'small_badge_mobile.html' %}
                {% endfor %}
              </td>
              <td class="col-3 mobile-table-info mobile-table-right">
                {% if teacher_view_student_profile or student_profile %}
                  <h4>{{checkpoint.percent_complete}}%</h4>
                  <p class="text-muted">complete</p>
                {% else %}
                  <a href="#" class="btn btn-info">view</a>
                {% endif %}
              </td>
            </tr>
          {% endif %}
      {% endfor %}
      </table>
    </div>
    {% if student_profile or teacher_view_student_profile %}
      <div class="tab-pane fade {% if active_tab == 'requests' %}in active{% endif %}" id="requests-mobile">
        <table class="table mobile-table">
          <tr class="mobile-break-row">
            <td class="mobile-break-row " colspan="2"><h5>Active badge requests</h5></td>
          </tr>
          {% set requests = course.requests %}
          {% if requests %}
            {% for request in requests %}
              {% if request.status in ['revoked', 'denied', 'requested'] %}
                {% set badge = request.badge %}
                <tr>
                  <td class="col-9 mobile-table-left">
                    <h4>{{badge.name}}</h4>
                    <p>{{request.status}}</p>
                    <p>Last update: <span class="text-muted">{{request.last_modified}}</span></p>
                  </td>
                  <td class="col-3 mobile-table-right mobile-badge-table">
                      {% if teacher_view_student_profile %}
                      <a href="/student_badge/{{course.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view">
                      {% else %}
                      <a href="/student_badge/{{teacherID}}/{{courseID}}/{{request.badge_id}}">
                      {% endif %}
                      <div class="small-badge">
                        <div  class="badge-new" style="background: {{badge.background}}; color: {{badge.icon_color}}">
                          <div class="badge-icon-container"><i class="icon-{{badge.icon}}"></i></div>
                        </div>
                      </div>
                    </a>
                  </td>
                </tr>
              {% endif %}
            {% endfor %}
          {% endif %}
        </table>
      </div>
    {% else %}
      <div class="tab-pane fade {% if active_tab == 'requests' %}in active{% endif %}" id="requests-mobile">
        <table class="table mobile-table">
          <tr class="mobile-break-row">
            <td class="mobile-break-row " colspan="2"><h5>Your badge requests</h5></td>
          </tr>
            {% set requests = course.requests %}
            {% if course.number_of_badge_requests > 0 %}
              {% for request in requests %}
                {% if request.status == 'requested' %}
                {% set badge = request.badge %}
                <tr>
                  <td class="col-9 mobile-table-left">
                    <h4>{{request.student.formalName}}</h4>
                    <h5>{{badge.name}}</h5>
                    <p>{{request.status}}</p>
                  </td>
                  <td class="col-3 mobile-table-right mobile-badge-table">
                      <a href="/student_badge/{{request.student.key.id()}}/{{courseID}}/{{request.badge_id}}/teacher_view">
                      <div class="small-badge">
                        <div  class="badge-new" style="background: {{badge.background}}; color: {{badge.icon_color}}">
                          <div class="badge-icon-container"><i class="icon-{{badge.icon}}"></i></div>
                        </div>
                      </div>
                    </a>
                  </td>
                </tr>
                {% endif %}
              {% endfor %}
            {% endif %}
        </table>
      </div> 
    {% endif %}  
    {% if not (student_profile or teacher_view_student_profile) %}
      <div class="tab-pane fade {% if active_tab == 'students' %}in active{% endif %}" id="students-mobile">
        
        <table class="table mobile-table">
        <tr class="mobile-break-row">
          <td class="mobile-break-row " colspan="2"><h5>Students in this coursee</h5></td>
        </tr>
          {% if course.registrations %}
            {% for registration in course.registrations %}
              <tr> 
                <td class="col-8 mobile-table-left">
                  <h4>{{get_student(registration.student_id).formalName}}</h4>
                  {% if registration.status == 'revoked' %}
                    <p class="text-danger">enrollment revoked</p>
                  {% elif registration.status == 'approved' %}
                    <p class="text-success">enrolled</p>
                  {% elif registration.status == 'pending' %}
                    <p class="text-info">pending confirmation</p>
                  {% elif registration.status == 'denied' %}
                    <p class="text-danger">denied enrollment</p>
                  {% endif %}
                </td>
                <td class="col-4 mobile-table-right">
                  {% if registration.status == "pending"%}
                    <a class="btn-loading col-12 btn btn-success" href="/complete_registration/{{courseID}}/{{registration.student_id}}/approved">approve</a> <br><br>
                    <a class="btn btn-loading col-12 btn-danger" href="/complete_registration/{{courseID}}/{{registration.student_id}}/denied">deny</a>
                  {% elif registration.status == "approved" %}
                    <a class="btn-loading btn col-12 btn-warning" href="/complete_registration/{{courseID}}/{{registration.student_id}}/revoked">un-enroll</a> <br><br>
                    <a class="btn col-12 btn-info" href="/student_profile/{{registration.student_id}}/{{courseID}}/teacher_view">view</a>
                  {% elif registration.status == "denied" %}
                    <a class="btn-loading btn col-12 btn-success" href="/complete_registration/{{courseID}}/{{registration.student_id}}/approved">approve</a> 
                  {% elif registration.status == "revoked" %}
                    <a class="btn-loading btn col-12 btn-info" href="/complete_registration/{{courseID}}/{{registration.student_id}}/approved">re-admit</a>
                  {% endif %}  
                </td>
              </tr>
            {% endfor %}
          {% endif %}
        </table>
      </div>
      <div class="tab-pane fade {% if active_tab == 'settings' %}in active{% endif %}" id="settings-mobile">
        sdfsd
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}